---
import PostLayout from "src/layouts/post.astro";
import Collection from "src/components/posts/collection.astro";
import Article from "src/components/posts/article.astro";
import { getCollection, getEntryBySlug } from "astro:content";

const slug = "projects"; // simple edit of one param

export async function getStaticPaths({paginate}: { paginate: Function }) {
  const slug = "projects"
  const posts = await getCollection(
    slug,
    ({ data }) => !data.hidden
  );
  posts.sort(({data:{published:apub}},{data:{published:bpub}}) => bpub - apub);
  const { data: { page_size: pageSize }} = await getEntryBySlug("pages", slug);
  return paginate(posts, { pageSize });
}

const { data } = await getEntryBySlug("pages", slug);
const { page, page: {data: articles} } = Astro.props;

if (!data) {
  throw new Error(`Failed to get page with slug: ${slug}`);
}
---
<PostLayout frontmatter={data}>
  <Collection slug={slug} pagination={page} page={data}>
    { articles.map(item => <Article post={item} short_date={true} />)}
  </Collection>
</PostLayout>